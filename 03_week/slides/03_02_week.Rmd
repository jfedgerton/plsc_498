---
title: "Coding Assignment: Coordinate Systems, Axes, and Plot-Ready Data"
subtitle: "How position, scale, and transformation shape interpretation"
author: "Jared Edgerton"
output:
  xaringan::moon_reader:
    css: [default, metropolis, metropolis-fonts, plsc498.css]
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      slideNumberFormat: ""
---

# What you should remember

Today is a short recap of three ideas:

- **Linear vs transformed axes** (especially log)
- **Zoom vs crop** (coord vs scale limits)
- **Axis labels** (new: formatting with `{scales}`)

The goal is to give you copy-paste starter code for the in-class coding session.

---

# Setup: packages + reproducibility

```{r, message=FALSE, warning=FALSE}
# Install packages if needed (run once; then comment out)
# install.packages("ggplot2")
# install.packages("dplyr")
# install.packages("scales")

library(ggplot2)
library(dplyr)
library(scales)

set.seed(123)
```

---

# Synthetic data (vote-like)

We want realistic plotting problems:

- skewed values
- many small values + a long tail
- some zeros

```{r}
n <- 3000

df <- data.frame(
  unit_id = sprintf("%05d", 1:n),
  group = sample(c("A", "B"), size = n, replace = TRUE, prob = c(0.55, 0.45)),
  size = rexp(n, rate = 1/25)
)

df <- df %>%
  mutate(
    size = ifelse(runif(n) < 0.06, 0, size),
    votes = rpois(n, lambda = pmax(0, 40 * size))
  )
```

---

# Quick check

```{r}
summary(df$votes)
summary(df$size)
table(df$group)
```

---

# Baseline plot (linear axis)

```{r fig.width=7, fig.height=4}
p_linear <- ggplot(df, aes(x = votes)) +
  geom_histogram(bins = 50) +
  labs(x = "Votes (linear scale)", y = "Count of records")

p_linear
```

---

# Log recap: log scale (styling; data unchanged)

Use a log axis when ratios matter and the range is highly skewed.

```{r fig.width=7, fig.height=4, warning=FALSE}
p_log_scale <- ggplot(df, aes(x = votes)) +
  geom_histogram(bins = 50) +
  scale_x_log10() +
  labs(x = "Votes (log10 scale)", y = "Count of records")

p_log_scale
```

---

# Log recap: log-transformed data (new variable)

Use `log1p()` when zeros may exist.

```{r, echo=FALSE}
df <- df %>%
  mutate(log_votes_1p = log1p(votes))
```

```{r fig.width=7, fig.height=4}
p_log_data <- ggplot(df, aes(x = log_votes_1p)) +
  geom_histogram(bins = 50) +
  labs(x = "log(1 + votes)", y = "Count of records")

p_log_data
```

---

# Axis ranges recap: zoom (keeps data)

Zoom = change the view without dropping observations.

```{r fig.width=7, fig.height=4}
p_zoom <- ggplot(df, aes(x = votes)) +
  geom_histogram(bins = 50) +
  coord_cartesian(xlim = c(0, 300)) +
  labs(x = "Votes (zoomed view)", y = "Count of records")

p_zoom
```

---

# Axis ranges recap: crop (drops data)

Crop = enforce limits at the scale level (drops out-of-range values).

```{r fig.width=7, fig.height=4, warning=FALSE}
p_crop <- ggplot(df, aes(x = votes)) +
  geom_histogram(bins = 50) +
  scale_x_continuous(limits = c(0, 300)) +
  labs(x = "Votes (cropped)", y = "Count of records")

p_crop
```

---

# One more axis option: square-root scale

A square-root scale can help with nonnegative counts while keeping zero.

```{r fig.width=7, fig.height=4}
p_sqrt <- ggplot(df, aes(x = votes)) +
  geom_histogram(bins = 50) +
  scale_x_sqrt() +
  labs(x = "Votes (square-root scale)", y = "Count of records")

p_sqrt
```

---

# New: axis labels with {scales}

`{scales}` helps your axes communicate magnitude clearly.

Common patterns:

- commas for counts: `labels = scales::comma`
- custom number labels: `labels = scales::label_number(...)`
- percents: `labels = scales::label_percent()`

---

# Example: totals by group (default labels)

```{r}
group_totals <- df %>%
  group_by(group) %>%
  summarise(votes_total = sum(votes), .groups = "drop")
```

```{r fig.width=7, fig.height=4}
p_totals <- ggplot(group_totals, aes(x = group, y = votes_total)) +
  geom_col() +
  labs(x = "Group", y = "Total votes")

p_totals
```

---

# Example: totals by group (comma labels)

```{r fig.width=7, fig.height=4}
p_totals_comma <- ggplot(group_totals, aes(x = group, y = votes_total)) +
  geom_col() +
  scale_y_continuous(labels = scales::comma) +
  labs(x = "Group", y = "Total votes")

p_totals_comma
```

---

# Example: label_number (explicit formatting)

```{r fig.width=7, fig.height=4}
p_totals_labelnum <- ggplot(group_totals, aes(x = group, y = votes_total)) +
  geom_col() +
  scale_y_continuous(
    labels = scales::label_number(big.mark = ",", accuracy = 1)
  ) +
  labs(x = "Group", y = "Total votes")

p_totals_labelnum
```

---

# Save a plot (starter pattern)

Use `ggsave()` so your workflow is reproducible.

```{r}
dir.create("figures", showWarnings = FALSE)

ggsave(
  filename = "figures/recap_totals_by_group.png",
  plot = p_totals_comma,
  width = 7,
  height = 4
)
```

---

# What you should be able to say out loud

- “This is a **log scale**: the data are unchanged; spacing is ratio-based.”
- “This is a **log-transformed variable**: I created a new column.”
- “This is **zooming**: it changes the view but keeps observations.”
- “This is **cropping**: it drops observations outside limits.”
- “These labels use `{scales}` to make magnitude readable.”

---

# Transition to coding session

You now have starter code for:

- linear vs log vs sqrt
- zoom vs crop
- axis labeling with `{scales}`
- saving figures with `ggsave()`

Use this file as a template during the in-class coding session.
